settings: !!python/object/apply:lib.spack.spack_hpc_decoy
  kwds:
    spec: specs/spack_bluecrab.yaml
    tmpdir: /exec/rbradley/stage
    decoy_method: proot
    mounts: 
      # create a custom decoy location where spack will build new packages
      # singularity maps the decoy location to the production location in the container
      - host: /exec/rbradley/buildsite/tz2/
        local: /software/apps/spack
      # make sure the path below matches the factory location
      - host: /exec/rbradley/buildsite/factory
      - host: /software/apps/slurm/17.11.12.1.marcc
      - host: /software/centos7/usr
        local: /usr
      - host: /etc/ssl
        local: /etc/ssl
  # extraneous keys are ignored by object apply
  # test the environment before production
  # usage: make spack_hpc_run run=<runfile> deploy=<deploy> test
  test: >-
    ml proot && proot -b 
    /exec/rbradley/buildsite/tz2/:/software/apps/spack/ /bin/bash -c 
    'MODULEPATH=/software/apps/spack/m02/linux-centos7-x86_64/Core /bin/bash -norc'
