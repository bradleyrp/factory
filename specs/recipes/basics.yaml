dockerfiles:
  centos7: |
    # section: centos7
    FROM centos:centos7
  centos7_dev: |
    # section: centos7_dev
    RUN yum update -y
    RUN yum groupinstall -y 'Development Tools'
    RUN yum install -y wget
    RUN yum install -y which
    RUN yum install -y vim
    RUN yum install -y git
    RUN yum install -y make
    RUN yum install -y screen
    RUN yum install -y bzip2
    RUN yum install -y zlib-devel
    RUN mkdir -p /opt
    WORKDIR /opt
  user_sudo: |
    # section: make_user
    RUN getent group 100 > /dev/null 2>&1 || (groupmod -g 100 users)
    RUN useradd -m -u 1000 -g 100 user
    RUN echo 'user:secret' | chpasswd
    RUN yum install -y sudo
    RUN usermod -aG wheel user
    USER user
    WORKDIR /home/user

basic: 
  persist: true
  #! use of visit is somewhat clumsy. find another location
  site: "./visit"
  rebuild: false
  dockerfile:
    sequence: 
      - centos7
      - centos7_dev
      - user_sudo
  command: docker-compose run --service-ports deploy
  compose:
    version: '3'
    services:
      deploy:
        entrypoint: ['/bin/bash','-l']
        build: .
        image: factory:centos7_user
        volumes:
          - "../:/home/user/factory"

#! this file is deprecated see webdev.yaml
