docs:
  docs: |
    SPACK on BLUECRAB: select hardware
    This script is called by a menu from `bluecrab.yaml` or directly via make.
    It kicks off a spack build or inspection via `lib.spack.spack_hpc_run`.
    Usage example:
        make spack_hpc_run run=specs/spack_bc_run.yaml \
        deploy=specs/spack_bc_singularity.yaml name=bc-singleton
    The run flag selects this file which selects hardware.
    The deploy flag describes the decoy environment in which we run spack.
    The settings below will request a spec file from the command line.
    The spec file contains all of the information for the spack environments.
  hardware:
    debug: &debug
      --partition: debug
      --time: 120
      --cpus-per-task: 12
    test: &test
      --cpus-per-task: 12
      --qos: gpuv100
      --res: image_tests
      --gres: "gpu:1"
      --partition: gpuv100
      --time: 300
    gpuk80: &gpuk80
      --cpus-per-task: 12
      --gres: "gpu:2"
      --partition: debug
      --time: 120

settings:
  # set the command line flags
  # the deploy file tells us how to run spack
  deploy: !flag deploy 
  # get the spec file from CLI otherwise use the deploy file
  spec: !flag spec
  # select a section of the spec file by name
  name: !flag name
  # name of an environment via env.sh that provides yaml
  env_name: min
  # choose the hardware for the build
  sbatch: *debug
