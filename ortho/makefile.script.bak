
### makeface (MAKEfile interFACE) script-connect
### by Ryan Bradley, distributed under copyleft
### complements ortho/makefile.bak by routing all make commands to a script

MAKEFLAGS+=-s
RUN_ARGS:=$(wordlist 1,$(words $(MAKECMDGOALS)),$(MAKECMDGOALS))
CMD_CALL:=$(word 1,$(RUN_ARGS))
CMD_TAIL=$(wordlist 2,$(words $(RUN_ARGS)),$(RUN_ARGS))
# first arguments are routed to ./fac
$(word 1,$(RUN_ARGS)):
	echo "[STATUS] make will run: ./fac $@ $(CMD_TAIL) ${MAKEFLAGS}"
	./fac $@ $(CMD_TAIL) ${MAKEFLAGS}
# tailing arguments are not valid targets
$(wordlist 2,$(words $(RUN_ARGS)),$(RUN_ARGS)):
# always execute
# include the run arguments otherwise make will ignore the recipe if the name
#   of the recipe is the same as a folder (i.e. conda)
.PHONY: touchup $(word 1,$(RUN_ARGS))
touchup:
ifeq ($(RUN_ARGS),)
	@echo -e "\n[STATUS] usage: make <argument> ..."
	@echo "[STATUS] this makefile wraps ./fac"
	@echo "[STATUS] the ./fac script runs in a configurable environment"
	@echo -e "[STATUS] use \`make\` or \`./fac\` with the following usage\n"
	./fac -h
endif
# forget flags for recursive make calls
unexport MAKEFLAGS
unexport RUN_ARGS

